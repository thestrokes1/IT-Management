{% extends "frontend/base.html" %}

{% block title %}Create User - IT Management Platform{% endblock %}

{% block page_title %}Create New User{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto py-8">
    <!-- Header -->
    <div class="mb-8">
        <a href="{% url 'frontend:users' %}" class="text-blue-600 hover:text-blue-900 mb-4 inline-block">‚Üê Back to Users</a>
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Create New User</h1>
        <p class="text-gray-600">Add a new user account to the system</p>
    </div>

    <!-- Form -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8">
        {% if messages %}
            {% for message in messages %}
                <div class="mb-6 p-4 {% if message.tags %}bg-{{ message.tags }}-50 border border-{{ message.tags }}-200{% else %}bg-blue-50 border border-blue-200{% endif %} rounded-lg">
                    <p class="text-sm">{{ message }}</p>
                </div>
            {% endfor %}
        {% endif %}

        {% if form.non_field_errors %}
        <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
            <div class="text-red-800">
                {% for error in form.non_field_errors %}
                    <p class="font-medium">{{ error }}</p>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <form method="POST" class="space-y-8">
            {% csrf_token %}

            <!-- Account Information Section -->
            <div class="border-b border-gray-200 pb-8">
                <h2 class="text-xl font-semibold text-gray-900 mb-6">Account Information</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Username -->
                    <div class="md:col-span-2">
                        <label for="id_username" class="block text-sm font-medium text-gray-700 mb-2">
                            Username <span class="text-red-500">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="id_username" 
                            name="username"
                            value="{{ form.username.value|default:'' }}"
                            placeholder="Enter username"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent transition"
                            required
                        >
                        {% if form.username.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ form.username.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Email -->
                    <div class="md:col-span-2">
                        <label for="id_email" class="block text-sm font-medium text-gray-700 mb-2">
                            Email Address <span class="text-red-500">*</span>
                        </label>
                        <input 
                            type="email" 
                            id="id_email" 
                            name="email"
                            value="{{ form.email.value|default:'' }}"
                            placeholder="Enter email address"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent transition"
                            required
                        >
                        {% if form.email.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ form.email.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Password -->
                    <div>
                        <label for="id_password" class="block text-sm font-medium text-gray-700 mb-2">
                            Password <span class="text-red-500">*</span>
                        </label>
                        <input 
                            type="password" 
                            id="id_password" 
                            name="password"
                            placeholder="Enter password"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent transition"
                            required
                        >
                        <p class="text-xs text-gray-500 mt-1">Minimum 8 characters, include uppercase, lowercase, and numbers</p>
                        {% if form.password.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ form.password.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Confirm Password -->
                    <div>
                        <label for="id_password_confirm" class="block text-sm font-medium text-gray-700 mb-2">
                            Confirm Password <span class="text-red-500">*</span>
                        </label>
                        <input 
                            type="password" 
                            id="id_password_confirm" 
                            name="password_confirm"
                            placeholder="Confirm password"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent transition"
                            required
                        >
                        {% if form.password_confirm.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ form.password_confirm.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Personal Information Section -->
            <div class="border-b border-gray-200 pb-8">
                <h2 class="text-xl font-semibold text-gray-900 mb-6">Personal Information</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- First Name -->
                    <div>
                        <label for="id_first_name" class="block text-sm font-medium text-gray-700 mb-2">
                            First Name
                        </label>
                        <input 
                            type="text" 
                            id="id_first_name" 
                            name="first_name"
                            value="{{ form.first_name.value|default:'' }}"
                            placeholder="Enter first name"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent transition"
                        >
                        {% if form.first_name.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ form.first_name.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Last Name -->
                    <div>
                        <label for="id_last_name" class="block text-sm font-medium text-gray-700 mb-2">
                            Last Name
                        </label>
                        <input 
                            type="text" 
                            id="id_last_name" 
                            name="last_name"
                            value="{{ form.last_name.value|default:'' }}"
                            placeholder="Enter last name"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent transition"
                        >
                        {% if form.last_name.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ form.last_name.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Permissions Section -->
            <div class="pb-8">
                <h2 class="text-xl font-semibold text-gray-900 mb-6">Permissions & Status</h2>
                
                <div class="space-y-4">
                    <!-- Role -->
                    <div>
                        <label for="id_role" class="block text-sm font-medium text-gray-700 mb-2">
                            Role <span class="text-red-500">*</span>
                        </label>
                        <select 
                            id="id_role" 
                            name="role"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent transition"
                            required
                        >
                            <option value="">Select a role</option>
                            <option value="SUPERADMIN" {% if form.role.value == 'SUPERADMIN' %}selected{% endif %}>Super Administrator</option>
                            <option value="IT_ADMIN" {% if form.role.value == 'IT_ADMIN' %}selected{% endif %}>IT Administrator</option>
                            <option value="MANAGER" {% if form.role.value == 'MANAGER' %}selected{% endif %}>Manager</option>
                            <option value="TECHNICIAN" {% if form.role.value == 'TECHNICIAN' %}selected{% endif %}>Technician</option>
                            <option value="VIEWER" {% if form.role.value == 'VIEWER' %}selected{% endif %}>Viewer</option>
                        </select>
                        <p class="text-xs text-gray-500 mt-2">
                            <strong>Super Admin:</strong> Full system access | 
                            <strong>IT Admin:</strong> Manage users & system | 
                            <strong>Manager:</strong> Can manage tickets & projects | 
                            <strong>Technician:</strong> Can create & resolve tickets | 
                            <strong>Viewer:</strong> View-only access
                        </p>
                        {% if form.role.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ form.role.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Is Active -->
                    <div class="flex items-center gap-3">
                        <input 
                            type="checkbox" 
                            id="id_is_active" 
                            name="is_active"
                            class="rounded border-gray-300 text-blue-600 focus:ring-2 focus:ring-primary-500"
                            checked
                        >
                        <label for="id_is_active" class="text-sm font-medium text-gray-700">
                            Active User
                        </label>
                        <p class="text-xs text-gray-500">User can log in and access the system</p>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="flex gap-4 pt-4">
                <button 
                    type="submit" 
                    class="flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 font-medium transition"
                >
                    Create User
                </button>
                <a 
                    href="{% url 'frontend:users' %}" 
                    class="flex-1 bg-gray-200 text-gray-900 px-6 py-3 rounded-lg hover:bg-gray-300 font-medium transition text-center"
                >
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
